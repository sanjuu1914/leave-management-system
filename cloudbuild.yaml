steps:
# 1. Build Angular Frontend
- name: node:20
  entrypoint: npm
  args: ["install"]
  dir: "frontend"

- name: node:20
  entrypoint: npm
  args: ["run", "build"]
  dir: "frontend"

# 2. Deploy Backend to App Engine


# 3. Build Docker Image for Backend
- name: gcr.io/cloud-builders/docker
  args: ["build", "-t", "gcr.io/$PROJECT_ID/backend-image", "."]
  dir: "backend"

# 4. Push Docker Image to Google Container Registry
- name: gcr.io/cloud-builders/docker
  args: ["push", "gcr.io/$PROJECT_ID/backend-image"]

# 5. Deploy Backend to Cloud Run
- name: gcr.io/cloud-builders/gcloud
  args: [
      "run", "deploy", "backend-service",
      "--image", "gcr.io/$PROJECT_ID/backend-image",
      "--platform", "managed",
      "--region", "us-central1",
      "--allow-unauthenticated"
    ]

# 6. Deploy Frontend (Optional - If You Want to Deploy Frontend to Cloud Run)
- name: gcr.io/cloud-builders/docker
  args: ["build", "-t", "gcr.io/$PROJECT_ID/frontend-image", "."]
  dir: "frontend"

- name: gcr.io/cloud-builders/docker
  args: ["push", "gcr.io/$PROJECT_ID/frontend-image"]

- name: gcr.io/cloud-builders/gcloud
  args: [
      "run", "deploy", "frontend-service",
      "--image", "gcr.io/$PROJECT_ID/frontend-image",
      "--platform", "managed",
      "--region", "us-central1",
      "--allow-unauthenticated"
    ]
options:
  logging: CLOUD_LOGGING_ONLY